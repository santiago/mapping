{"ts":1348772119707,"silentsave":true,"restoring":false,"patch":[[{"diffs":[[1,"/**\n * Module dependencies.\n */\n\nvar express = require('express');\nvar everyauth = require('everyauth');\nvar stylus = require('stylus');\nvar gzippo = require('gzippo');\nvar app = module.exports = express.createServer();\n\nvar env= require('./env');\n\n// Configuration\nfunction compile(str, path) {\n    return stylus(str)\n\t.set('filename', path)\n\t// .set('compress', true);\n}\n\n\napp.configure(function(){\n    this.set('views', __dirname + '/views');\n    this.set('view engine', 'jade');\n    this.set('view options', { layout: 'layout' })\n    this.use(express.bodyParser());\n    this.use(express.logger());\n    this.use(express.methodOverride());\n    this.use(express.cookieParser());\n    this.use(express.session({secret: 'Eah4tfzGAKhr'}));\n    this.use(stylus.middleware({\n\tsrc: __dirname + '/views'\n\t, dest: __dirname + '/public'\n\t, compile: compile\n    }));\n    this.use(express.favicon(__dirname + '/public/favicon.ico', { maxAge: 2592000000}));\n    // this.use(express.static(__dirname + '/public'));\n    this.use(gzippo.staticGzip(__dirname + '/public'));    \n    this.use(everyauth.middleware());\n    // Keep this as last one\n    this.use(this.router);\n});\n\n\napp.configure('development', function(){\n    app.use(express.errorHandler({ dumpExceptions: true, showStack: true })); \n});\n\napp.configure('production', function(){\n  app.use(express.errorHandler());\n});\n\napp.get('/', function(req, res) {\n    console.log(req.user);\n    NodeModel.find({}, function(err, records) {\n\tres.render('index', {\n\t    locals: {\n\t\tnodes: records\n\t    }\n\t});\n    });\n});\n\napp.get('/data/node/:id.html', function(req, res) {\n    var id= req.params.id;\n    NodeModel.findById(id, function(err, node){\n\tres.render('data/node', {\n\t    layout: false,\n\t    locals: {\n\t\tnode: node\n\t    }\n\t});\n    });\n});\n\napp.get('/listado', function(req, res) {\n    NodeModel.find({},function(err, records){\n        res.render('listado', {\n            layout: 'layout_no_map',\n            nodes: records\n        });\n   });\n});\n\napp.get('/proyectos.json', function(req, res) {\n    NodeModel.find({},function(err, records){\n\tvar nodes= [];\n\trecords.forEach(function(_node) {\n\t    var _node= _node.toObject();\n\t    // delete _node['_id'];\n\t    delete _node['date'];\n\t    nodes.push(_node);\n\t})\n\n\tres.send(nodes);\n   });\n});\n\napp.post('/registro', function(req, res){\n    var node= new NodeModel(req.body);\n    node.save(function(error, _node) {\n\tvar _node= _node.toObject();\n\t// delete _node['_id'];\n\tdelete _node['date'];\n\tres.send(_node);\n    });\n});\n\n\n// Only listen on $ node app.js\nif (!module.parent) {\n\n    console.log(everyauth.facebook.entryPath());\n    app.listen(6660);\n    console.log(\"Express server listening on port %d\", app.address().port)\n}\n"]],"start1":0,"start2":0,"length1":0,"length2":2717}]],"length":2717}
{"contributors":[],"silentsave":false,"ts":1348785284546,"patch":[[{"diffs":[[0,");\n\n"],[-1,"app.get('/data/node/:id.html', function(req, res) {\n    var id= req.params.id;\n    NodeModel.findById(id, function(err, node){\n\tres.render('data/node', {\n\t    layout: false,\n\t    locals: {\n\t\tnode: node\n\t    }\n\t});\n    });\n});\n\napp.get('/listado', function(req, res) {\n    NodeModel.find({},function(err, records){\n        res.render('listado', {\n            layout: 'layout_no_map',\n            nodes: records\n        });\n   });\n});\n\napp.get('/proyectos.json', function(req, res) {\n    NodeModel.find({},function(err, records){\n\tvar nodes= [];\n\trecords.forEach(function(_node) {\n\t    var _node= _node.toObject();\n\t    // delete _node['_id'];\n\t    delete _node['date'];\n\t    nodes.push(_node);\n\t})\n\n\tres.send(nodes);\n   });\n});\n\napp.post('/registro', function(req, res){\n    var node= new NodeModel(req.body);\n    node.save(function(error, _node) {\n\tvar _node= _node.toObject();\n\t// delete _node['_id'];\n\tdelete _node['date'];\n\tres.send(_node);\n    });\n});\n\n\n"],[0,"// O"]],"start1":1552,"start2":1552,"length1":966,"length2":8}]],"length":1759,"saved":false}
{"ts":1348785313198,"patch":[[{"diffs":[[0,") {\n"],[-1,"    console.log(req.user);\n    NodeModel.find({}, function(err, records) {\n"],[0,"\tres"]],"start1":1397,"start2":1397,"length1":83,"length2":8},{"diffs":[[0,"es: "],[-1,"records"],[1,"[]"],[0,"\n\t  "]],"start1":1444,"start2":1444,"length1":15,"length2":10},{"diffs":[[0,"});\n"],[-1,"    });\n"],[0,"});\n"]],"start1":1459,"start2":1459,"length1":16,"length2":8}]],"length":1671,"saved":false}
{"ts":1348785315255,"patch":[[{"diffs":[[0,"ls: {\n\t\t"],[1,"    "],[0,"nodes: ["]],"start1":1433,"start2":1433,"length1":16,"length2":20}]],"length":1675,"saved":false}
{"ts":1348785340276,"patch":[[{"diffs":[[0,") {\n"],[-1,"\n"],[0,"    "],[-1,"console.log(everyauth.facebook.entryPath())"],[1,"var port = 6660"],[0,";\n  "]],"start1":1522,"start2":1522,"length1":56,"length2":27},{"diffs":[[0,"d\", "],[-1,"app.address()."],[0,"port"]],"start1":1620,"start2":1620,"length1":22,"length2":8}]],"length":1632,"saved":false}
{"ts":1348785346317,"patch":[[{"diffs":[[0,".listen("],[-1,"6660"],[1,"port"],[0,");\n    c"]],"start1":1554,"start2":1554,"length1":20,"length2":20}]],"length":1632,"saved":false}
{"ts":1348786179502,"patch":[[{"diffs":[[0,");\n});\n\n"],[-1,"\n"],[0,"app.conf"]],"start1":1153,"start2":1153,"length1":17,"length2":16},{"diffs":[[0,");\n});\n\n"],[1,"function isArray(o) {\n    return Object.prototype.toString.call(o) === '[object Array]';\n}\n\n// Start Services\n['Mapping', 'Point', 'Comment'].forEach(function(name) {\n    var service = require('domain/'+name).service;\n    if (typeof\n});\n\n"],[0,"// Only "]],"start1":1463,"start2":1463,"length1":16,"length2":254}]],"length":1869,"saved":false}
{"ts":1348786477645,"patch":[[{"diffs":[[0,");\n\n"],[-1,"function isArray(o) {\n    return Object.prototype.toString.call(o) === '[object Array]';\n}\n\n"],[0,"// S"]],"start1":1467,"start2":1467,"length1":100,"length2":8},{"diffs":[[0," service"],[1,"s"],[0," = requi"]],"start1":1553,"start2":1553,"length1":16,"length2":17},{"diffs":[[0,"if ("],[-1,"typeof"],[1,"!(services instanceof Array)) {\n        services = [services]\n    }\n    services.forEach(function(s) { s(app) });"],[0,"\n});"]],"start1":1602,"start2":1602,"length1":14,"length2":121}]],"length":1885,"saved":false}
{"ts":1348786642280,"patch":[[{"diffs":[[0,") { "],[1,"\n        app.services[name] = "],[0,"s(app)"],[1,";\n   "],[0," });"]],"start1":1705,"start2":1705,"length1":14,"length2":49},{"diffs":[[0,");\n});\n\n"],[1,"app.services = \n\n"],[0,"// Only "]],"start1":1752,"start2":1752,"length1":16,"length2":33}]],"length":1937,"saved":false}
{"ts":1348786670532,"patch":[[{"diffs":[[0,"vices = "],[1,"{};"],[0,"\n\n// Onl"]],"start1":1767,"start2":1767,"length1":16,"length2":19}]],"length":1940,"saved":false}
{"ts":1348786681451,"patch":[[{"diffs":[[0,"ervices\n"],[1,"app.services = {};\n"],[0,"['Mappin"]],"start1":1481,"start2":1481,"length1":16,"length2":35},{"diffs":[[0,");\n\n"],[-1,"app.services = {};\n\n"],[0,"// O"]],"start1":1775,"start2":1775,"length1":28,"length2":8}]],"length":1939,"saved":false}
{"ts":1348794178389,"patch":[[{"diffs":[[0,"equire('"],[1,"./"],[0,"domain/'"]],"start1":1585,"start2":1585,"length1":16,"length2":18}]],"length":1941,"saved":false}
{"ts":1348796450793,"patch":[[{"diffs":[[0,");\n});\n\n"],[1,"// Start Auth\nrequire('./lib/Auth')(app);\n\n"],[0,"// Start"]],"start1":1463,"start2":1463,"length1":16,"length2":59}]],"length":1984,"saved":false}
{"ts":1348796483867,"patch":[[{"diffs":[[0,"./env');"],[1,"\napp.env = env;"],[0,"\n\n// Con"]],"start1":239,"start2":239,"length1":16,"length2":31}]],"length":1999,"saved":false}
{"ts":1348796638592,"patch":[[{"diffs":[[0,");\n\n"],[-1,"// Start Auth\nrequire('./lib/Auth')(app);\n\n"],[0,"// S"]],"start1":1482,"start2":1482,"length1":51,"length2":8}]],"length":1956,"saved":false}
{"ts":1348796649692,"patch":[[{"diffs":[[0,"ue);\n}\n\n"],[1,"// Start Auth\nrequire('./lib/Auth')(app);\n"],[0,"\napp.con"]],"start1":381,"start2":381,"length1":16,"length2":58}]],"length":1998,"saved":false}
{"ts":1348809879987,"patch":[[{"diffs":[[0,"ware({\n\t"],[1,"    "],[0,"src: __d"]],"start1":820,"start2":820,"length1":16,"length2":20},{"diffs":[[0,"views'\n\t"],[1,"    "],[0,", dest: "]],"start1":851,"start2":851,"length1":16,"length2":20},{"diffs":[[0,"ublic'\n\t"],[1,"    "],[0,", compil"]],"start1":886,"start2":886,"length1":16,"length2":20}]],"length":2010,"saved":false}
{"ts":1348810108528,"patch":[[{"diffs":[[0," res) {\n"],[1,"    console.log(req.session);\n"],[0,"\tres.ren"]],"start1":1461,"start2":1461,"length1":16,"length2":46}]],"length":2040,"saved":false}
{"ts":1348810122886,"patch":[[{"diffs":[[0,"req, res) {\n"],[1,"    console.log('\\n\\n\\n');\n"],[0,"    console."]],"start1":1457,"start2":1457,"length1":24,"length2":51}]],"length":2067,"saved":false}
